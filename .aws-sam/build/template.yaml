AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: Practicing SQS
Globals:
  Function:
    Timeout: 10
    CodeUri: src/
    Runtime: python3.8
Resources:
  DeadLetter:
    Type: AWS::SQS::Queue
  RawQueue:
    Type: AWS::SQS::Queue
    Properties:
      DelaySeconds: 0
      RedrivePolicy:
        deadLetterTargetArn:
          Fn::GetAtt:
          - DeadLetter
          - Arn
        maxReceiveCount: 4
      VisibilityTimeout: 120
  TriggerFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: app.lambda_handler
      Events:
        SQSEvent:
          Type: SQS
          Properties:
            Queue:
              Fn::GetAtt:
              - RawQueue
              - Arn
            BatchSize: 10
            Enabled: true
      CodeUri: TriggerFunction
    Metadata:
      SamResourceId: TriggerFunction
Outputs:
  RawSqsUrl:
    Description: URL of the sqs event
    Value:
      Ref: RawQueue
  DeadLetterUrl:
    Description: URL of the sqs event
    Value:
      Ref: DeadLetter
